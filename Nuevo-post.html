<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Post - tuCHISME</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="firebase-config.js"></script>
</head>
<body class="bg-gradient-to-br from-gray-50 to-indigo-50 min-h-screen flex items-center justify-center">
    <div class="w-full max-w-md bg-white rounded-2xl shadow-xl p-8">
        <!-- Título -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Crear Post</h1>
            <p class="text-gray-600">Comparte información y gana monedas</p>
        </div>

        <!-- Formulario -->
        <form id="createPostForm" class="space-y-6">
            <!-- Título -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Título</label>
                <input type="text" id="title" required
                       class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
            </div>

            <!-- Contenido -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Contenido</label>
                <textarea id="content" required
                          class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
            </div>

            <!-- Precio -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Precio (máximo 50 monedas)</label>
                <input type="number" id="price" min="0" max="50" required
                       class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
            </div>

            <!-- Categoría -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Categoría</label>
                <select id="category" required
                        class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    <option value="cuernos.html">Cuernos</option>
                    <option value="socios.html">Socios</option>
                    <option value="socios..html">Socios..</option>
                </select>
            </div>

            <!-- Botón de Enviar -->
            <button type="submit"
                    class="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition-all font-semibold flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                </svg>
                Publicar
            </button>
        </form>
    </div>

    <script>
        document.getElementById('createPostForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            // Verificar si el usuario está autenticado
            const user = auth.currentUser;
            if (!user) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Debes iniciar sesión para crear un post.',
                    confirmButtonColor: '#6366f1'
                });
                return;
            }

            // Obtener valores del formulario
            const title = document.getElementById('title').value;
            const content = document.getElementById('content').value;
            const price = parseInt(document.getElementById('price').value);
            const category = document.getElementById('category').value;

            // Validar el precio
            if (price > 50) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'El precio máximo es de 50 monedas.',
                    confirmButtonColor: '#6366f1'
                });
                return;
            }

            // Guardar el post en Firestore
            try {
                await db.collection('posts').add({
                    title,
                    content,
                    price,
                    category,
                    authorId: user.uid,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    buyers: [] // Lista de usuarios que han comprado el post
                });

                Swal.fire({
                    icon: 'success',
                    title: '¡Post creado!',
                    text: 'Tu post ha sido publicado correctamente.',
                    confirmButtonColor: '#6366f1'
                }).then(() => {
                    window.location.href = 'feed.html'; // Redirigir al feed
                });
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: error.message,
                    confirmButtonColor: '#6366f1'
                });
            }
        });
    </script>
</body>
</html>
